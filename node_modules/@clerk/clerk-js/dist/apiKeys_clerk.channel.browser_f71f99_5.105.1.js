"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["616"],{2010:function(e,t,i){i.r(t),i.d(t,{APIKeys:()=>R,APIKeysPage:()=>O});var a=i(3312),o=i(1024),r=i(4690),n=i(9144),l=i(1019),s=i(267),d=i(9281),c=i(1576),p=i(4204),y=i(9805),u=i(2672),m=i(1319),h=i(2930),K=i(4174),_=i(1217),x=i(6847),g=i(3009),Z=i(2156);let f=({rows:e,isLoading:t,onRevoke:i,elementDescriptor:o,canManageAPIKeys:r})=>(0,a.tZ)(p.Flex,{sx:e=>({width:"100%",[_.mqu.sm]:{overflowX:"auto",padding:e.space.$0x25}}),children:(0,a.BX)(p.Table,{sx:e=>({background:e.colors.$colorBackground}),elementDescriptor:o,children:[(0,a.tZ)(p.Thead,{children:(0,a.BX)(p.Tr,{children:[(0,a.tZ)(p.Th,{children:"Name"}),(0,a.tZ)(p.Th,{children:"Last used"}),r&&(0,a.tZ)(p.Th,{children:"Actions"})]})}),(0,a.tZ)(p.Tbody,{children:t?(0,a.tZ)(p.Tr,{children:(0,a.tZ)(p.Td,{colSpan:3,children:(0,a.tZ)(p.Spinner,{colorScheme:"primary",sx:{margin:"auto",display:"block"},elementDescriptor:p.descriptors.spinner})})}):e.length?e.map(e=>(0,a.BX)(p.Tr,{children:[(0,a.tZ)(p.Td,{children:(0,a.BX)(p.Flex,{direction:"col",sx:{minWidth:"25ch"},children:[(0,a.tZ)(p.Text,{variant:"subtitle",truncate:!0,children:e.name}),(0,a.tZ)(p.Text,{variant:"caption",colorScheme:"secondary",localizationKey:e.expiration?(0,p.localizationKeys)("apiKeys.createdAndExpirationStatus__expiresOn",{createdDate:e.createdAt,expiresDate:e.expiration}):(0,p.localizationKeys)("apiKeys.createdAndExpirationStatus__never",{createdDate:e.createdAt})})]})}),(0,a.tZ)(p.Td,{children:(0,a.tZ)(p.Box,{sx:{minWidth:"10ch"},children:(0,a.tZ)(p.Text,{localizationKey:e.lastUsedAt?(0,Z.S)(e.lastUsedAt):"-"})})}),r&&(0,a.tZ)(p.Td,{children:(0,a.tZ)(g.a,{actions:[{label:(0,p.localizationKeys)("apiKeys.menuAction__revoke"),isDestructive:!0,onClick:()=>i(e.id,e.name)}]})})]},e.id)):(0,a.tZ)(D,{})})]})}),D=()=>(0,a.tZ)(p.Tr,{children:(0,a.tZ)(p.Td,{colSpan:4,children:(0,a.tZ)(p.Text,{localizationKey:(0,p.localizationKeys)("apiKeys.detailsTitle__emptyRow"),sx:{margin:"auto",display:"block",width:"fit-content"}})})});var b=i(4709),C=i(431),v=i(9460),T=i(8487),F=i(3146),w=i(6788);let z=["never","1d","7d","30d","60d","90d","180d","1y"],S={"1d":e=>e.setDate(e.getDate()+1),"7d":e=>e.setDate(e.getDate()+7),"30d":e=>e.setDate(e.getDate()+30),"60d":e=>e.setDate(e.getDate()+60),"90d":e=>e.setDate(e.getDate()+90),"180d":e=>e.setDate(e.getDate()+180),"1y":e=>e.setFullYear(e.getFullYear()+1)},k=e=>{if("never"===e||!e)return;let t=new Date,i=new Date(t);return S[e](i),Math.floor((i.getTime()-t.getTime())/1e3)},B=({selectedExpiration:e,setSelectedExpiration:t})=>{let i=(0,n.useRef)(null),{t:o}=(0,p.useLocalizations)(),r=z.map(e=>({value:e,label:o((0,p.localizationKeys)((e=>{switch(e){case"never":return"apiKeys.formFieldOption__expiration__never";case"1d":return"apiKeys.formFieldOption__expiration__1d";case"7d":return"apiKeys.formFieldOption__expiration__7d";case"30d":return"apiKeys.formFieldOption__expiration__30d";case"60d":return"apiKeys.formFieldOption__expiration__60d";case"90d":return"apiKeys.formFieldOption__expiration__90d";case"180d":return"apiKeys.formFieldOption__expiration__180d";case"1y":return"apiKeys.formFieldOption__expiration__1y"}})(e)))}));return(0,a.BX)(F.Ph,{elementId:"apiKeyExpiration",options:r,value:e?.value??"",onChange:t,placeholder:o((0,p.localizationKeys)("formFieldInputPlaceholder__apiKeyExpirationDate")),referenceElement:i,children:[(0,a.tZ)(F.UN,{ref:i,icon:K.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),"aria-labelledby":"expiration-field",id:"expiration-field"}),(0,a.tZ)(F.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorForeground})})]})},I=({onCreate:e,isSubmitting:t})=>{let[i,o]=(0,n.useState)(null),{close:r}=(0,b.XC)(),{showDescription:l=!1}=(0,c.useApiKeysContext)(),{t:s}=(0,p.useLocalizations)(),d=(0,w.Yp)("name","",{type:"text",label:(0,p.localizationKeys)("formFieldLabel__apiKeyName"),placeholder:(0,p.localizationKeys)("formFieldInputPlaceholder__apiKeyName"),isRequired:!0}),y=(0,w.Yp)("apiKeyDescription","",{type:"text",label:(0,p.localizationKeys)("formFieldLabel__apiKeyDescription"),placeholder:(0,p.localizationKeys)("formFieldInputPlaceholder__apiKeyDescription"),isRequired:!1}),u=d.value.length>2,m=(0,n.useMemo)(()=>{let e=k(i?.value);if(!i?.value||!e)return s((0,p.localizationKeys)("apiKeys.formFieldCaption__expiration__never"));let t=new Date(Date.now()+1e3*e);return s((0,p.localizationKeys)("apiKeys.formFieldCaption__expiration__expiresOn",{date:t.toLocaleString(void 0,{year:"numeric",month:"long",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0,timeZoneName:"short"})}))},[i?.value]);return(0,a.tZ)(T.Y,{headerTitle:(0,p.localizationKeys)("apiKeys.formTitle"),headerSubtitle:(0,p.localizationKeys)("apiKeys.formHint"),elementDescriptor:p.descriptors.apiKeysCreateForm,children:(0,a.BX)(C.l.Root,{onSubmit:t=>{t.preventDefault(),e({name:d.value,description:y.value||void 0,secondsUntilExpiration:k(i?.value)})},children:[(0,a.BX)(p.Box,{sx:e=>({gap:e.space.$4,display:"flex",flexDirection:"row",[_.mqu.sm]:{flexDirection:"column"}}),children:[(0,a.tZ)(C.l.ControlRow,{sx:{flex:1},elementId:d.id,elementDescriptor:p.descriptors.apiKeysCreateFormNameInput,children:(0,a.tZ)(C.l.PlainInput,{...d.props})}),(0,a.BX)(p.Col,{sx:{flex:1,width:"100%"},gap:2,elementDescriptor:p.descriptors.apiKeysCreateFormExpirationInput,children:[(0,a.BX)(p.FormLabel,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"row"},htmlFor:"expiration-field",children:[(0,a.tZ)(p.Text,{as:"span",variant:"subtitle",localizationKey:(0,p.localizationKeys)("formFieldLabel__apiKeyExpiration")}),(0,a.tZ)(p.Text,{variant:"caption",colorScheme:"secondary",localizationKey:(0,p.localizationKeys)("formFieldHintText__optional")})]}),(0,a.tZ)(B,{selectedExpiration:i,setSelectedExpiration:o}),(0,a.tZ)(p.Text,{variant:"caption",colorScheme:"secondary",localizationKey:m,elementDescriptor:p.descriptors.apiKeysCreateFormExpirationCaption})]})]}),l&&(0,a.tZ)(p.Col,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$borderAlpha100,paddingTop:e.space.$4,paddingBottom:e.space.$4}),children:(0,a.tZ)(C.l.ControlRow,{elementId:y.id,elementDescriptor:p.descriptors.apiKeysCreateFormDescriptionInput,children:(0,a.tZ)(C.l.PlainInput,{...y.props})})}),(0,a.tZ)(v.A,{submitLabel:(0,p.localizationKeys)("apiKeys.formButtonPrimary__add"),isDisabled:!u,onReset:r,isLoading:t,elementDescriptor:p.descriptors.apiKeysCreateFormSubmitButton})]})})};var A=i(7901);let P=(0,n.lazy)(()=>i.e("642").then(i.bind(i,3250)).then(e=>({default:e.RevokeAPIKeyConfirmationModal}))),L=(0,n.lazy)(()=>Promise.all([i.e("573"),i.e("672")]).then(i.bind(i,9306)).then(e=>({default:e.CopyApiKeyModal}))),O=({subject:e,perPage:t,revokeModalRoot:i})=>{let c=(0,x.ir)(e),g=(0,d.N2)({permission:"org:sys_api_keys:read"}),Z=(0,d.N2)({permission:"org:sys_api_keys:manage"}),{apiKeys:D,isLoading:b,search:C,setSearch:v,page:T,setPage:F,pageCount:w,itemCount:z,startingRow:S,endingRow:k,cacheKey:B}=(({subject:e,perPage:t=5,enabled:i})=>{let a=(0,r.cL)(),o={key:"api-keys",subject:e},{data:l,isLoading:s,mutate:d}=(0,A.ZP)(i?o:null,()=>a.apiKeys.getAll({subject:e})),[c,p]=(0,n.useState)(""),{page:y,setPage:u,pageCount:m,itemCount:h,startingRow:K,endingRow:_,paginatedItems:x}=((e,t)=>{let[i,a]=(0,n.useState)(1),o=e.length,r=Math.max(1,Math.ceil(o/t)),l=o>0?(i-1)*t+1:0,s=Math.min(i*t,o),d=e.slice(l-1,s);return{page:i,setPage:a,pageCount:r,itemCount:o,startingRow:l,endingRow:s,paginatedItems:d}})((l??[]).filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),t);return{apiKeys:x,cacheKey:o,mutate:d,isLoading:s,search:c,setSearch:p,page:y,setPage:u,pageCount:m,itemCount:h,startingRow:K,endingRow:_}})({subject:e,perPage:t,enabled:!c||g}),O=(0,u.useCardState)(),R=(0,r.cL)(),{data:X,trigger:E,isMutating:$}=(0,s.Z)({...B,action:"create"},(e,{arg:t})=>R.apiKeys.create(t)),{mutate:N}=(0,l.kY)(),{t:j}=(0,p.useLocalizations)(),[M,Y]=(0,n.useState)(!1),[q,U]=(0,n.useState)(""),[W,H]=(0,n.useState)(""),[G,J]=(0,n.useState)(!1),Q=async t=>{try{await E({...t,subject:e}),N(B),O.setError(void 0),J(!0)}catch(e){(0,o.kD)(e)&&409===e.status&&O.setError("API Key name already exists")}};return(0,a.BX)(p.Col,{gap:4,sx:{width:"100%"},elementDescriptor:p.descriptors.apiKeys,children:[(0,a.BX)(y.a.Root,{children:[(0,a.BX)(p.Flex,{justify:"between",align:"center",gap:4,sx:{[_.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},elementDescriptor:p.descriptors.apiKeysHeader,children:[(0,a.tZ)(p.Box,{elementDescriptor:p.descriptors.apiKeysSearchBox,children:(0,a.tZ)(m.W,{placeholder:j((0,p.localizationKeys)("apiKeys.action__search")),leftIcon:(0,a.tZ)(p.Icon,{icon:K.Yt}),value:C,onChange:e=>{v(e.target.value),F(1)},elementDescriptor:p.descriptors.apiKeysSearchInput})}),(c&&Z||!c)&&(0,a.tZ)(y.a.Trigger,{value:"add-api-key",hideOnActive:!1,children:(0,a.tZ)(p.Button,{variant:"solid",localizationKey:(0,p.localizationKeys)("apiKeys.action__add"),elementDescriptor:p.descriptors.apiKeysAddButton})})]}),(0,a.tZ)(y.a.Open,{value:"add-api-key",children:(0,a.tZ)(p.Flex,{sx:e=>({paddingTop:e.space.$6,paddingBottom:e.space.$6}),children:(0,a.tZ)(y.a.Card,{sx:{width:"100%"},children:(0,a.tZ)(I,{onCreate:Q,isSubmitting:$})})})}),(0,a.tZ)(L,{isOpen:G,onOpen:()=>J(!0),onClose:()=>J(!1),apiKeyName:X?.name??"",apiKeySecret:X?.secret??"",modalRoot:i})]}),(0,a.tZ)(f,{rows:D,isLoading:b,onRevoke:(e,t)=>{U(e),H(t),Y(!0)},elementDescriptor:p.descriptors.apiKeysTable,canManageAPIKeys:c&&Z||!c}),z>(t??5)&&(0,a.tZ)(h.t,{count:w,page:T,onChange:F,siblingCount:1,rowInfo:{allRowsCount:z,startingRow:S,endingRow:k}}),(0,a.tZ)(P,{subject:e,isOpen:M,onOpen:()=>Y(!0),onClose:()=>{U(""),H(""),Y(!1)},apiKeyId:q,apiKeyName:W,modalRoot:i})]})},R=(0,c.withCoreUserGuard)((0,u.withCardStateProvider)(()=>{let e=(0,c.useApiKeysContext)(),{user:t}=(0,r.aF)(),{organization:i}=(0,r.o8)(),o=i?.id??t?.id??"";return(0,a.tZ)(p.Flow.Root,{flow:"apiKeys",sx:{width:"100%"},children:(0,a.tZ)(O,{subject:o,perPage:e.perPage})})}))}}]);